<!DOCTYPE HTML>
<html>
<head>
<script>
fetch('http://127.0.0.1:5000/analyze?ticker=msft')
.then(response => response.json())
.then(data => render_graph(data));
const render_graph = data => {
    const currentData = data['stats']['Close'];
    const predictions = data['preds']['Forecast'];
    // console.log(currentData);
    let pxVals = Object.getOwnPropertyNames(predictions);
    pxVals = pxVals.map(Number);
    let pyVals = Object.values(predictions);
    let xVals = Object.getOwnPropertyNames(currentData);
    xVals = xVals.map(Number);
    let yVals = Object.values(currentData);
    const ctx = document.getElementById('myChart');
    var limit = 761; 
    var data = [];
    var dataSeries = { type: "line" };
    var predSeries = { type: "line", markerSize: 1 }
    var dataPoints = [];
    var predPoints = [];

    for (var i = 0; i < xVals.length ; i += 1) {
        dataPoints.push({
            x: new Date(xVals[i]),
            y: yVals[i]
        });
    }

    predPoints.push({x:new Date(xVals[xVals.length-1]), y:yVals[yVals.length-1]});
    for( var j  = 0; j<pxVals.length; j++){
        predPoints.push({
            x:new Date(pxVals[j]),
            y: pyVals[j]
        })
    }
    dataSeries.dataPoints = dataPoints;
    predSeries.dataPoints = predPoints;
    data.push(dataSeries);
    data.push(predSeries);

    //Better to construct options first and then pass it as a parameter
    var options = {
        zoomEnabled: true,
        animationEnabled: true,
        title: {
            text: "Stock Predictions for the next 30 days"
        },
        axisY: {
            lineThickness: 1
        },
        data: data  // random data
    };

    var chart = new CanvasJS.Chart("chartContainer", options);
    var startTime = new Date();
    chart.render();
    var endTime = new Date();
    document.getElementById("tickerName").innerHTML = "Ticker name: ";
}
</script>
<style>
	#tickerName {
		position:absolute; 
		top: 10px; 
		font-size: 20px; 
		font-weight: bold; 
		background-color: #d85757;
		padding: 0px 4px;
		color: #ffffff;
	}
</style>
</head>
<body>
<div id="chartContainer" style="height: 300px; width: 100%;"></div>
<span id="tickerName"></span>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

</body>
</html>